{"version":3,"sources":["webpack:///webpack/bootstrap 6b12fb6e287568a7487c","webpack:///./config.js","webpack:///external \"jsonwebtoken\"","webpack:///external \"async\"","webpack:///./index.js","webpack:///external \"tutu-framework\"","webpack:///external \"path\"","webpack:///external \"orm\"","webpack:///external \"express-session\"","webpack:///./admin_router.js","webpack:///./controller/index.js","webpack:///./controller/auth_controller.js","webpack:///./helper/authHelper.js","webpack:///external \"crypto-js\"","webpack:///external \"buffer\"","webpack:///external \"crypto\"","webpack:///./controller/restful_controller.js","webpack:///external \"lodash\"","webpack:///external \"express\"","webpack:///./model/index.js","webpack:///./model/user.js","webpack:///./model/menu.js","webpack:///./model/role.js","webpack:///./model/domain.js"],"names":["settings","database","href","protocol","authKey","jwtKey","port","module","exports","framework","require","path","orm","session","config","dev","global","tutu","Object","assign","Logger","app","use","resave","saveUninitialized","secret","connect","err","db","logger","error","models","set","debug","init","sync","listen","controllers","router","Router","verifyToken","auth","post","login","all","logout","get","restful","adminList","put","adminUpdate","adminCreate","delete","adminDelete","jwt","async","authHelper","req","res","email","body","password","json","errCode","errMsg","user","find","userList","length","decrypt","token","sign","expiresIn","auto","saveUserInfo","cb","encryptToken","md5","lastLogin","Date","save","getMenus","role","log","menus","result","code","next","verify","decoded","JSON","stringify","_id","CryptoJS","encrypt","plainText","encrypted","AES","toString","encryptedText","decryptedBytes","decrypted","enc","Utf8","data","Buffer","buf","str","crypto","createHash","update","digest","modelName","callback","_","id","si","one","item","params","model","query","or","each","allProperties","n","i","search","orData","like","push","total","count","list","chainResult","limit","parseInt","offset","page","newEntity","cloneDeep","create","j","isObject","key","hasOne","field","autoFetch","autoFetchLimit","menu","hasMany","domain","expireAt","type","time","privilege","define","phone","username","required","name","createAt","hooks","beforeCreate","afterLoad","title","link","icon","sort","parentId","afterSave","obj","domainId","String","callbackURL"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6b12fb6e287568a7487c","var settings = {\n  database: {\n    href:\n      \"mongodb://indentity:t6wYKJGgD50MBjuA@live.chinabolang.com:3455/hyper-identity\",\n    protocol: \"mongodb\" // or \"mysql\"\n  },\n  authKey: \"tO#*lcUJGh%3S4jqYYV1aOaTe^McLPzr\",\n  jwtKey: \"9q*1ommi@gh4a9iErPF&71M%o!&QM7tL\",\n  port: 3500\n};\n\nmodule.exports = settings;\n\n\n\n// WEBPACK FOOTER //\n// ./config.js","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"async\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"async\"\n// module id = 2\n// module chunks = 0","const framework = require(\"tutu-framework\");\nconst path = require(\"path\");\nconst orm = require(\"orm\");\nconst session = require(\"express-session\");\nconst config = require(\"./config\");\n\nconfig.dev = !(process.env.NODE_ENV === \"production\");\n\nglobal.tutu = {};\nObject.assign(tutu, framework.Logger);\ntutu.config = Object.assign({}, config);\n\n// session\nframework.app.use(\n  session({\n    resave: false,\n    saveUninitialized: false,\n    secret: \"tutu\"\n  })\n);\n\nframework.app.use(\"/api\", require(\"./admin_router\"));\n\n// connect server\norm.connect(tutu.config.database, function(err, db) {\n  if (err) {\n    tutu.logger.error(err);\n    throw err;\n  }\n\n  tutu.models = db.models;\n  db.settings.set(\"instance.returnAllErrors\", true);\n  tutu.logger.debug(\"Database connected\");\n\n  require(\"./model\").init(orm, db);\n\n  db.sync(function() {\n    tutu.logger.debug(\"Database synced\");\n\n    // init db\n    // let importData = require('./importData');\n    // importData.importData(tutu);\n\n    // Listen the server\n    framework.app.listen(tutu.config.port, () => {\n      tutu.logger.debug(\"Server listening on port:\" + config.port);\n    });\n  });\n});\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","module.exports = require(\"tutu-framework\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"tutu-framework\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"orm\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"orm\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"express-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-session\"\n// module id = 7\n// module chunks = 0","const controllers = require('./controller');\nconst router = require('express').Router();\n\nconst verifyToken = controllers.auth.verifyToken;\n\nrouter.post('/login', controllers.auth.login);\nrouter.all('/logout', controllers.auth.logout);\n\n// router.post('/changePassword', controllers.admin.changePassword);\nrouter.post('/verifyToken', verifyToken);\n\nrouter.get('/:model', verifyToken, controllers.restful.adminList);\nrouter.put('/:model', controllers.restful.adminUpdate);\nrouter.post('/:model', controllers.restful.adminCreate);\nrouter.delete('/:model/:id', controllers.restful.adminDelete);\n\nmodule.exports = router;\n\n\n// WEBPACK FOOTER //\n// ./admin_router.js","module.exports = {\n    auth: require('./auth_controller'),\n    restful: require('./restful_controller'),\n};\n\n\n// WEBPACK FOOTER //\n// ./controller/index.js","const jwt = require('jsonwebtoken');\nconst async = require('async');\nconst authHelper = require('../helper/authHelper');\n\nmodule.exports = {\n    login: function (req, res) {\n        let email = req.body.email;\n        let password = req.body.password;\n\n        if (!email || !password) {\n            return res.json({ errCode: 'Email_Password_Empty', errMsg: '邮箱和密码不能为空' });\n        }\n    \n        tutu.models.user.find({ email }, function (err, userList) {\n            if (userList.length == 0 || password != authHelper.decrypt(userList[0].password)) {\n                tutu.logger.debug('Email_Password_Not_Match', email, password, authHelper.decrypt(userList[0].password) || 'no user found');\n                return res.json({ errCode: 'Email_Password_Not_Match', errMsg: '邮箱或密码错误' });\n            }\n    \n            let user = userList[0];\n            let token = jwt.sign(user, tutu.config.jwtKey, { expiresIn: '1d' });\n    \n            async.auto({\n                saveUserInfo: function (cb) {\n                    user.encryptToken = authHelper.md5(token);\n                    user.lastLogin = new Date();\n    \n                    user.save(function (err) {\n                        if (err) {\n                            tutu.logger.error(err);\n                        }\n                        user.password = null;\n                        delete user.password;\n    \n                        cb(err, user);\n                    });\n                },\n                getMenus: function (cb) {\n                    let role = user.role;\n                    tutu.logger.log('user', user);\n                    role.getMenus(function (err, menus) {\n                        cb(err, menus);\n                    });\n                },\n            }, function (err, result) {\n                tutu.logger.debug('Admin Login', email);\n                req.session.token = token;\n                req.session.user = result.saveUserInfo;\n                req.session.menus = result.getMenus;\n                \n                return res.json({ user: result.saveUserInfo, menus: result.getMenus, code: 200, token });\n            });\n        });\n    },\n\n    verifyToken: function (req, res, next) {\n        let token = req.body.token || req.get('Admin-Token');\n        \n        if (!token) {\n            return res.json({ errCode: 'Token_Empty', errMsg: 'Token为空' });\n        }\n    \n        // verify token\n        jwt.verify(token, tutu.config.jwtKey, function (err, decoded) {\n            if (err) {\n                tutu.logger.debug('Verify token failed', JSON.stringify(err));\n                return res.json({ errCode: 'Token_Verify_Error', errMsg: 'Token验证失败' });\n            }\n\n            tutu.models.user.get(decoded._id, function (err, user) {\n                if (err) {\n                    tutu.logger.debug(`Find user error`, JSON.stringify(err));\n                    return res.json({ errCode: `Token_Get_user_Failed`, errMsg: 'Token验证失败' });\n                }\n    \n                if (user.encryptToken == authHelper.md5(token)) {\n                    if (req.path == '/verifyToken') {\n                        let role = user.role;\n                        role.getMenus(function (err, menus) {\n                            req.session.user = user;\n                            req.session.menus = menus;\n                            return res.json({ code: 200, user, menus});\n                        });\n                    } else {\n                        next();\n                    }\n                } else {\n                    tutu.logger.debug('Token_Verify_Not_Match', user.encryptToken, authHelper.md5(token));\n                    return res.json({ errCode: 'Token_Verify_Not_Match', errMsg: 'Token过期' });\n                }\n            });\n        });\n    },\n\n    logout: function (req, res) {\n        req.session.user = null;\n        req.session.token = null;\n        req.session.menus = null;\n        res.json({code: 200});\n    },        \n\n    // changePassword: function (req, res) {\n    //     let _id = req.body._id;\n    //     let oldPassword = req.body.oldPassword;\n    //     let newPassword = req.body.newPassword;\n    //     let confirmPassword = req.body.confirmPassword;\n        \n    //     let proxy = serviceHelper.getService();\n        \n    //     proxy.changePassword({_id, oldPassword, newPassword, confirmPassword}, result => {\n    //         tutu.logger.debug({_id, oldPassword, newPassword, confirmPassword});\n            \n    //         return res.json(result);\n    //     });\n    // },\n};\n\n\n// WEBPACK FOOTER //\n// ./controller/auth_controller.js","const config = require('../config');\nconst CryptoJS = require(\"crypto-js\");\nconst jwt = require('jsonwebtoken');\n\nmodule.exports = {\n    encrypt: function (plainText) {\n        let encrypted = CryptoJS.AES.encrypt(plainText, config.authKey);\n        return encrypted.toString();\n    },\n    decrypt: function (encryptedText) {\n        let decryptedBytes = CryptoJS.AES.decrypt(encryptedText, config.authKey);\n        let decrypted = decryptedBytes.toString(CryptoJS.enc.Utf8);\n        return decrypted;\n    },\n    md5: function(data) {\n        var Buffer = require(\"buffer\").Buffer;\n        var buf = new Buffer(data);\n        var str = buf.toString(\"binary\");\n        var crypto = require(\"crypto\");\n        return crypto.createHash(\"md5WithRSAEncryption\").update(str).digest(\"hex\");\n    },\n    // Wrapper for verifyToken\n    verifyToken: function(token, modelName, callback) {\n        if (!token) {\n            return callback({ errCode: 'Token_Empty', errMsg: 'Token为空' });\n        }\n    \n        // verify token\n        jwt.verify(token, config.jwtKey, function (err, decoded) {\n            if (err) {\n                tutu.logger.debug('Verify token failed', JSON.stringify(err));\n                return callback({ errCode: 'Token_Verify_Error', errMsg: 'Token验证失败' });\n            }\n\n            tutu.models[modelName].get(decoded._id, function (err, user) {\n                if (err) {\n                    tutu.logger.debug(`Find [${modelName}] error`, JSON.stringify(err));\n                    return callback({ errCode: `Token_Get_${modelName}_Failed`, errMsg: 'Token验证失败' });\n                }\n    \n                if (user.encryptToken == module.exports.md5(token)) {\n                    return callback({ code: 200, user });\n                } else {\n                    tutu.logger.debug('Token_Verify_Not_Match', user.encryptToken, module.exports.md5(token));\n                    return callback({ errCode: 'Token_Verify_Not_Match', errMsg: 'Token过期' });\n                }\n            });\n        });\n    }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./helper/authHelper.js","module.exports = require(\"crypto-js\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypto-js\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"buffer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"buffer\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"crypto\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypto\"\n// module id = 14\n// module chunks = 0","const _ = require(\"lodash\");\nconst async = require(\"async\");\n\nconst get = function(modelName, id, callback) {\n  let si = {};\n  si._id = id;\n\n  tutu.models[modelName].one(si, function(err, one) {\n    if (err) {\n      tutu.logger.debug(\n        \"AdminOne [\" + modelName + \"] error\",\n        JSON.stringify(err)\n      );\n      return callback({\n        errCode: \"DB_Query_Failed\",\n        errMsg: \"数据库查询失败\"\n      });\n    }\n    tutu.logger.debug(\"AdminOne [\" + modelName + \"]\", id, one !== null);\n\n    return callback({ code: 200, item: one });\n  });\n};\n\nmodule.exports = {\n  adminList: function(req, res, next) {\n    let modelName = req.params.model;\n    let model = tutu.models[modelName];\n    let query = req.query;\n    let si = {};\n\n    if (query && query.query) {\n      si.or = [];\n\n      _.each(model.allProperties, (n, i) => {\n        tutu.logger.debug(n, i);\n        if (n.search) {\n          let orData = {};\n          orData[i] = orm.like(query.query);\n          si.or.push(orData);\n        }\n      });\n    }\n\n    async.auto(\n      {\n        total: function(cb) {\n          model.count(si, function(err, count) {\n            if (err) {\n              tutu.logger.debug(\n                \"AdminCount [\" + modelName + \"] error\",\n                JSON.stringify(err)\n              );\n              return cb(\n                { errCode: \"DB_Count_Failed\", errMsg: \"数据库查询失败\" },\n                null\n              );\n            }\n\n            tutu.logger.debug(\n              \"AdminCount [\" + modelName + \"]\",\n              JSON.stringify(query),\n              count\n            );\n\n            cb(null, count);\n          });\n        },\n        list: function(cb) {\n          let chainResult = model.find(si);\n          chainResult\n            .limit(_.parseInt(query.limit))\n            .offset((_.parseInt(query.page) - 1) * _.parseInt(query.limit));\n          chainResult.all(function(err, list) {\n            if (err) {\n              tutu.logger.debug(\n                \"AdminFind [\" + modelName + \"] error\",\n                JSON.stringify(err)\n              );\n              return cb(\n                { errCode: \"DB_Query_Failed\", errMsg: \"数据库查询失败\" },\n                null\n              );\n            }\n\n            tutu.logger.debug(\n              \"AdminFind [\" + modelName + \"]\",\n              JSON.stringify(query),\n              list.length\n            );\n\n            cb(null, list);\n          });\n        }\n      },\n      function(err, result) {\n        if (err) {\n          res.json({ errCode: \"DB_Query_Failed\", errMsg: \"数据库查询失败\" });\n        }\n        res.json({ code: 200, list: result.list, total: result.total });\n      }\n    );\n  },\n\n  adminCreate: function(req, res, next) {\n    let modelName = req.params.model;\n    let newEntity = _.cloneDeep(req.body);\n\n    tutu.logger.debug('New', modelName, newEntity);\n\n    tutu.models[modelName].create(newEntity, function(err) {\n      if (err) {\n        tutu.logger.debug(\n          \"AdminCreate [\" + modelName + \"] error\",\n          JSON.stringify(err)\n        );\n        return res.json({\n          errCode: \"DB_Create_Failed\",\n          errMsg: \"数据库插入失败\"\n        });\n      }\n      tutu.logger.debug(\n        \"AdminCreate [\" + modelName + \"]\",\n        JSON.stringify(newEntity)\n      );\n\n      return res.json({ code: 200 });\n    });\n  },\n\n  adminUpdate: function(req, res, next) {\n    let modelName = req.params.model;\n    let newEntity = _.cloneDeep(req.body);\n    let id = newEntity._id;\n    if (!id) {\n      return res.json({ errCode: \"Id_Empty\", errMsg: \"Id不能为空\" });\n    }\n    delete newEntity.id;\n\n    get(modelName, id, result => {\n      if (result.errCode) {\n        return res.json(result);\n      }\n\n      if (!result.item) {\n        return res.json({ errCode: \"Object_Not_Found\", errMsg: \"找不到对象\" });\n      }\n\n      item = result.item;\n\n      for (var j in item) {\n        if (_.isObject(item[j])) {\n          delete item[j];\n        }\n      }\n\n      for (var j in newEntity) {\n        if (_.isObject(newEntity[j])) {\n          delete newEntity[j];\n        }\n      }\n\n      for (key in newEntity) {\n        item[key] = newEntity[key];\n      }\n\n      tutu.logger.debug(\n        \"AdminUpdate [\" + modelName + \"]\",\n        id,\n        JSON.stringify(newEntity)\n      );\n\n      item.save(() => {\n        return res.json({ code: 200, item });\n      });\n    });\n  },\n\n  adminDelete: function(req, res, next) {\n    let id = req.params.id;\n    if (!id) {\n      return res.json({ errCode: \"Id_Empty\", errMsg: \"Id不能为空\" });\n    }\n\n    return res.json({ code: 200 });\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./controller/restful_controller.js","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 17\n// module chunks = 0","var init = function(orm, db) {\n  require(\"./user\")(orm, db);\n  require(\"./menu\")(orm, db);\n  require(\"./role\")(orm, db);\n  require(\"./domain\")(orm, db);\n  // require('./userDomain')(orm,db);\n\n  db.models.user.hasOne(\n    \"role\",\n    db.models.role,\n    { field: \"roleId\" },\n    { autoFetch: true, autoFetchLimit: 2 }\n  );\n\n  db.models.menu.hasOne(\n    \"parentMenu\",\n    db.models.menu,\n    { field: \"parentId\" },\n    { autoFetch: true }\n  );\n\n  db.models.role.hasMany(\"menus\", db.models.menu, {}, { autoFetch: true });\n\n  db.models.user.hasMany(\n    \"domains\",\n    db.models.domain,\n    {\n      expireAt: { type: \"date\", time: true },\n      privilege: { type: \"text\" }\n    },\n    { autoFetch: true }\n  );\n\n  db.models.domain.hasOne(\n    \"parentDomain\",\n    db.models.domain,\n    { field: \"parentId\" },\n    { autoFetch: true }\n  );\n};\n\nmodule.exports.init = init;\n\n\n\n// WEBPACK FOOTER //\n// ./model/index.js","module.exports = function(orm, db) {\n  var Object = db.define(\n    \"user\",\n    {\n      email: { type: \"text\" },\n      phone: { type: \"text\" },\n      username: { type: \"text\" },\n      password: { type: \"text\", required: true },\n      name: { type: \"text\" },\n      encryptToken: { type: 'text' },\n      expireAt: { type: \"date\", time: true },\n      lastLogin: { type: \"date\", time: true },\n      createAt: { type: \"date\", time: true }\n    },\n    {\n      hooks: {\n        beforeCreate: function(next) {\n          this.createAt = new Date();\n          return next();\n        },\n        afterLoad: function(next) {\n          // 兼容mongodb\n          if (this._id) {\n            this.id = this._id;\n          }\n          next();\n        }\n      }\n    }\n  );\n};\n\n\n\n// WEBPACK FOOTER //\n// ./model/user.js","module.exports = function(orm, db) {\n    var menu = db.define('menu', {\n        title: { type: 'text' },\n        link: { type: 'text' },\n        icon: { type: 'text' },\n        sort: { type: 'integer' },\n        parentId: { type: 'integer' },\n    }, {\n        hooks: {\n            afterSave: function() {\n                if (this.sort) {\n                    this.sort = parseInt(this.sort);\n                }\n                if (!this.parentId) {\n                    this.parentId = null;\n                }\n            }\n        }\n    });\n};\n\n\n// WEBPACK FOOTER //\n// ./model/menu.js","module.exports = function(orm, db) {\n    var role = db.define('role', {\n        name: { type: 'text' },\n    });\n};\n\n\n// WEBPACK FOOTER //\n// ./model/role.js","module.exports = function(orm, db) {\n    var obj = db.define('domain', {\n        domainId: String,\n        name: String,\n        callbackURL: {type: 'text'}\n    });\n};\n\n\n// WEBPACK FOOTER //\n// ./model/domain.js"],"sourceRoot":""}